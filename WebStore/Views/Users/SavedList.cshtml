@model WebStore.Models.ViewModel

@{
    ViewBag.Title = "Favourites List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<style>

    .col {
        margin-bottom: 38px;
    }



    .a-blank {
        color: inherit;
        text-decoration: none;
    }

        .a-blank:hover,
        .card:hover .card-text h5 {
            color: #1e9469 !important;
            text-decoration: none !important;
        }

    .card {
        width: 18rem;
        margin-right: 5px;
        background-color: #181a1b;
        padding: 0;
    }

    .card-text h5 {
        font-size: .875rem;
        font-weight: 500;
        line-height: 2rem;
        text-align: center;
        color: rgb(232, 230, 227);
        width: 100%;
        word-break: break-word;
    }

    .bi-heart-fill:hover,
    .bi-heart {
        color: black;
        text-decoration: none !important;
        /* <i class="bi bi-heartbreak-fill"></i> */
    }

        .bi-heart:hover,
        .bi-heart-fill {
            color: red;
            text-decoration: none !important;
        }

    .add-to-cart {
        background-color: #1e9469;
        border: 1px solid #186e57;
        color: white;
    }

        .add-to-cart:hover {
            background-color: #136144;
        }
</style>

<div class="page">

    <h1 class="text-center m-4">@Model.User.Forename's Favourites</h1>
    <hr class="my-4">

    <!-- Sort removed for now -->

    <div class="container-fluid text-center">
        <div class="row row-cols-auto">
            @foreach (WebStore.Models.Product product in Model.Products)
            {
                <div class="col">
                    <div class="card mb-3 position-relative h-100">

                        <div style="height: 300px; background-color: white; position: relative;">

                            <!-- Product image -->
                            <a href="@Url.Action("Details", "Products", new {productID = product.ProductID})" class="text-link">
                                <img src="@Url.Action("GetImage", "Images", new { id = product.DefaultImageID, height = 300, width = 300 })" class="card-img-top" alt="[Product Image]" style="width: 100%; height: 100%; object-fit: cover;" />
                            </a>

                            <!-- Favourite button -->
                            <a class="bi-heart-fill position-absolute top-0 end-0 m-3" onclick="RemoveFavourite(event, @product.ProductID, '@product.Name')"></a>

                        </div>

                        <div class="card-body">

                            <!-- Product title -->
                            <a href="@Url.Action("Details", "Products", new {productID = product.ProductID})" class="text-link">
                                <h5 class="card-title">@Html.DisplayFor(p => product.Name)</h5>
                            </a>

                            <!-- Product category -->
                            <p class="card-text">Category: <a href="@Url.Action("Index", "Products", new { category = product.CategoryID } )">@Html.DisplayFor(p => product.Category.Name)</a></p>

                        </div>

                        <!-- Price & Cart button -->
                        <div class="card-footer d-flex align-items-center justify-content-between" style="margin: 10px 0;">
                            <p class="card-text" style="font-weight: bold; font-size: 1.4em; margin-bottom: 0; color: white;">£@Html.DisplayFor(p => product.Price)</p>
                            <button class="btn btn-success add-to-cart">Add to Cart <i class="bi bi-cart2"></i></button>
                        </div>

                    </div>
                </div>
            }
        </div>
    </div>

</div>

<script>

    function RemoveFavourite(event, productID, productName)
    {

        var confirmed = window.confirm(`Remove ${productName} from favourites?`);

        var buttonElement = $(event.target);

        if (confirmed)
        {
            // REMOVE FAVOURITE
            $.ajax(
            {
                url: "@Url.Action("RemoveFavourite", "Users")",
                method: "Post",
                data:
                {
                    userID: 1,
                    productID: productID
                },
                success: function (data) {
                    //alert("Item removed from favourites.");

                    // Delete card from view by deleting its containing column (to ensure proper spacing)
                    buttonElement.closest('.col').remove();
                },
                    error: function (error) { console.log(`Error removing Product ${productID} from User ${userID}\'s favourites.\n\n${JSON.stringify(error)}`); }
            });
        }

    }


</script>


